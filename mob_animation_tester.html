<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mob Animation Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            display: flex;
            gap: 20px;
        }
        
        #canvasContainer {
            background: #1a1a2e;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
        }
        
        #gameCanvas {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
        }
        
        #controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .control-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .control-group h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }
        
        .slider-container label {
            min-width: 80px;
            font-weight: bold;
            color: #555;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn:hover {
            background: #0056b3;
        }
        
        .export-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-top: 20px;
        }
        
        .export-btn:hover {
            background: #c82333;
        }
        
        .code-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin-top: 10px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .mob-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mob-type-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .mob-type-btn.active {
            background: #28a745;
        }
        
        .mob-type-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="canvasContainer">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
    </div>
    
    <div id="controls">
        <h2>üëπ Mob Animation Tester</h2>
        <p>Dostosuj animacje mob√≥w za pomocƒÖ slider√≥w</p>
        
        <div class="control-group">
            <h3>üé≠ Typ Moba</h3>
            <div class="mob-type-selector">
                <button class="mob-type-btn active" onclick="setMobType('basic')">Basic</button>
                <button class="mob-type-btn" onclick="setMobType('fast')">Fast</button>
                <button class="mob-type-btn" onclick="setMobType('tank')">Tank</button>
            </div>
        </div>
        
        <div class="preset-buttons">
            <button class="preset-btn" onclick="loadPreset('patrol')">Patrol</button>
            <button class="preset-btn" onclick="loadPreset('chase')">Chase</button>
            <button class="preset-btn" onclick="loadPreset('attack')">Attack</button>
            <button class="preset-btn" onclick="resetAll()">Reset</button>
        </div>
        
        <div class="control-group">
            <h3>üìù Nazwa animacji</h3>
            <input type="text" id="animationName" placeholder="np. patrol, attack, chase" value="patrol" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        
        <div class="control-group">
            <h3>üë§ G≈Çowa</h3>
            <div class="slider-container">
                <label>Offset X:</label>
                <input type="range" id="headOffsetX" min="-30" max="30" value="-2" oninput="updateAnimation()">
                <div class="slider-value" id="headOffsetX-value">-2</div>
            </div>
            <div class="slider-container">
                <label>Offset Y:</label>
                <input type="range" id="headOffsetY" min="-60" max="20" value="-35" oninput="updateAnimation()">
                <div class="slider-value" id="headOffsetY-value">-35</div>
            </div>
            <div class="slider-container">
                <label>Rotation:</label>
                <input type="range" id="headRotation" min="-1.5" max="1.5" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="headRotation-value">0</div>
            </div>
        </div>
        
        <div class="control-group">
            <h3>üéΩ Tors</h3>
            <div class="slider-container">
                <label>Offset X:</label>
                <input type="range" id="bodyOffsetX" min="-30" max="30" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="bodyOffsetX-value">0</div>
            </div>
            <div class="slider-container">
                <label>Offset Y:</label>
                <input type="range" id="bodyOffsetY" min="-30" max="30" value="-5" oninput="updateAnimation()">
                <div class="slider-value" id="bodyOffsetY-value">-5</div>
            </div>
            <div class="slider-container">
                <label>Rotation:</label>
                <input type="range" id="bodyRotation" min="-1.5" max="1.5" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="bodyRotation-value">0</div>
            </div>
        </div>
        
        <div class="control-group">
            <h3>ü¶µ Pozycja N√≥g</h3>
            <div class="slider-container">
                <label>Left Leg X:</label>
                <input type="range" id="leftLegX" min="-20" max="20" value="10" oninput="updateAnimation()">
                <div class="slider-value" id="leftLegX-value">10</div>
            </div>
            <div class="slider-container">
                <label>Right Leg X:</label>
                <input type="range" id="rightLegX" min="-20" max="20" value="3" oninput="updateAnimation()">
                <div class="slider-value" id="rightLegX-value">3</div>
            </div>
            <div class="slider-container">
                <label>Body Bob:</label>
                <input type="range" id="bodyBob" min="-10" max="10" value="2" oninput="updateAnimation()">
                <div class="slider-value" id="bodyBob-value">2</div>
            </div>
        </div>
        
        <div class="control-group">
            <h3>ü¶µ Lewa Noga</h3>
            <div class="slider-container">
                <label>Thigh Bend Y:</label>
                <input type="range" id="leftThighBendY" min="-20" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftThighBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Thigh Rotation:</label>
                <input type="range" id="leftThighRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftThighRotation-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Bend Y:</label>
                <input type="range" id="leftShinBendY" min="-50" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShinBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Bend X:</label>
                <input type="range" id="leftShinBendX" min="-30" max="30" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShinBendX-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Rotation:</label>
                <input type="range" id="leftShinRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShinRotation-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Bend Y:</label>
                <input type="range" id="leftShoeBendY" min="-70" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShoeBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Bend X:</label>
                <input type="range" id="leftShoeBendX" min="-40" max="40" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShoeBendX-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Rotation:</label>
                <input type="range" id="leftShoeRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="leftShoeRotation-value">0</div>
            </div>
        </div>
        
        <div class="control-group">
            <h3>ü¶µ Prawa Noga</h3>
            <div class="slider-container">
                <label>Thigh Bend Y:</label>
                <input type="range" id="rightThighBendY" min="-20" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightThighBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Thigh Rotation:</label>
                <input type="range" id="rightThighRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightThighRotation-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Bend Y:</label>
                <input type="range" id="rightShinBendY" min="-50" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShinBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Bend X:</label>
                <input type="range" id="rightShinBendX" min="-30" max="30" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShinBendX-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shin Rotation:</label>
                <input type="range" id="rightShinRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShinRotation-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Bend Y:</label>
                <input type="range" id="rightShoeBendY" min="-70" max="20" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShoeBendY-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Bend X:</label>
                <input type="range" id="rightShoeBendX" min="-40" max="40" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShoeBendX-value">0</div>
            </div>
            <div class="slider-container">
                <label>Shoe Rotation:</label>
                <input type="range" id="rightShoeRotation" min="-3" max="3" step="0.1" value="0" oninput="updateAnimation()">
                <div class="slider-value" id="rightShoeRotation-value">0</div>
            </div>
        </div>
        
        <button class="export-btn" onclick="exportAnimation()">üìã Export Animation Code</button>
        
        <div id="codeOutput" class="code-output" style="display: none;"></div>
    </div>

    <script>
        let canvas, ctx;
        let mobAtlas;
        let currentMobType = 'basic';
        let animationTimer = 0;
        
        // Initialize
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Load mob atlas
            mobAtlas = new Image();
            mobAtlas.src = 'assets/charatlas-mob.png';
            mobAtlas.onload = function() {
                console.log('Mob atlas loaded');
                startAnimation();
            };
            
            // Fallback if no atlas
            setTimeout(() => {
                if (!mobAtlas.complete) {
                    console.log('Using fallback rendering');
                    startAnimation();
                }
            }, 1000);
        };
        
        function startAnimation() {
            updateAnimation();
            setInterval(() => {
                animationTimer += 0.016;
                render();
            }, 16);
        }
        
        function setMobType(type) {
            currentMobType = type;
            
            // Update button states
            document.querySelectorAll('.mob-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateAnimation();
        }
        
        function updateAnimation() {
            // Update slider values display
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                const valueDisplay = document.getElementById(slider.id + '-value');
                if (valueDisplay) {
                    valueDisplay.textContent = slider.value;
                }
            });
            
            render();
        }
        
        function render() {
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Get current values
            const headOffsetX = parseInt(document.getElementById('headOffsetX').value);
            const headOffsetY = parseInt(document.getElementById('headOffsetY').value);
            const headRotation = parseFloat(document.getElementById('headRotation').value);
            const bodyOffsetX = parseInt(document.getElementById('bodyOffsetX').value);
            const bodyOffsetY = parseInt(document.getElementById('bodyOffsetY').value);
            const bodyRotation = parseFloat(document.getElementById('bodyRotation').value);
            const leftLegX = parseInt(document.getElementById('leftLegX').value);
            const rightLegX = parseInt(document.getElementById('rightLegX').value);
            const bodyBob = parseInt(document.getElementById('bodyBob').value);
            
            // Get leg parameters
            const leftThighBendY = parseInt(document.getElementById('leftThighBendY').value);
            const leftThighRotation = parseFloat(document.getElementById('leftThighRotation').value);
            const leftShinBendY = parseInt(document.getElementById('leftShinBendY').value);
            const leftShinBendX = parseInt(document.getElementById('leftShinBendX').value);
            const leftShinRotation = parseFloat(document.getElementById('leftShinRotation').value);
            const leftShoeBendY = parseInt(document.getElementById('leftShoeBendY').value);
            const leftShoeBendX = parseInt(document.getElementById('leftShoeBendX').value);
            const leftShoeRotation = parseFloat(document.getElementById('leftShoeRotation').value);
            
            const rightThighBendY = parseInt(document.getElementById('rightThighBendY').value);
            const rightThighRotation = parseFloat(document.getElementById('rightThighRotation').value);
            const rightShinBendY = parseInt(document.getElementById('rightShinBendY').value);
            const rightShinBendX = parseInt(document.getElementById('rightShinBendX').value);
            const rightShinRotation = parseFloat(document.getElementById('rightShinRotation').value);
            const rightShoeBendY = parseInt(document.getElementById('rightShoeBendY').value);
            const rightShoeBendX = parseInt(document.getElementById('rightShoeBendX').value);
            const rightShoeRotation = parseFloat(document.getElementById('rightShoeRotation').value);
            
            // Mob position
            const mobX = canvas.width / 2 - 40;
            const mobY = canvas.height / 2 - 60;
            
            // Get mob dimensions based on type
            let mobWidth, mobHeight;
            switch(currentMobType) {
                case 'basic':
                    mobWidth = 80; mobHeight = 120;
                    break;
                case 'fast':
                    mobWidth = 70; mobHeight = 110;
                    break;
                case 'tank':
                    mobWidth = 100; mobHeight = 140;
                    break;
            }
            
            ctx.save();
            
            // Draw mob using atlas or fallback
            if (mobAtlas.complete) {
                drawMobFromAtlas(ctx, mobX, mobY, mobWidth, mobHeight, {
                    headOffsetX, headOffsetY, headRotation,
                    bodyOffsetX, bodyOffsetY, bodyRotation,
                    leftLegX, rightLegX, bodyBob,
                    leftThighBendY, leftThighRotation,
                    leftShinBendY, leftShinBendX, leftShinRotation,
                    leftShoeBendY, leftShoeBendX, leftShoeRotation,
                    rightThighBendY, rightThighRotation,
                    rightShinBendY, rightShinBendX, rightShinRotation,
                    rightShoeBendY, rightShoeBendX, rightShoeRotation
                });
            } else {
                // Fallback - simple colored rectangle
                ctx.fillStyle = currentMobType === 'basic' ? '#ff4444' : 
                               currentMobType === 'fast' ? '#44ff44' : '#4444ff';
                ctx.fillRect(mobX, mobY, mobWidth, mobHeight);
                
                // Add label
                ctx.fillStyle = 'white';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${currentMobType.toUpperCase()} MOB`, mobX + mobWidth/2, mobY + mobHeight/2);
                ctx.fillText('(Atlas not loaded)', mobX + mobWidth/2, mobY + mobHeight/2 + 20);
            }
            
            ctx.restore();
            
            // Draw info
            ctx.fillStyle = 'white';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Mob Type: ${currentMobType}`, 10, 30);
            ctx.fillText(`Size: ${mobWidth}x${mobHeight}`, 10, 50);
        }
        
        function drawMobFromAtlas(ctx, x, y, width, height, offsets) {
            // Atlas coordinates with full leg system
            const headCoords = { x: 20, y: 7, w: 154, h: 126 };
            const bodyCoords = { x: 6, y: 137, w: 165, h: 124 };
            const legCoords = { 
                leftThigh: { x: 50, y: 263, w: 40, h: 92 }, 
                leftShin: { x: 43, y: 355, w: 53, h: 70 },
                leftShoe: { x: 31, y: 442, w: 62, h: 68 },
                rightThigh: { x: 93, y: 261, w: 47, h: 97 },
                rightShin: { x: 100, y: 361, w: 44, h: 64 },
                rightShoe: { x: 97, y: 446, w: 83, h: 57 }
            };
            
            // Apply mob type color tint
            switch(currentMobType) {
                case 'basic':
                    ctx.filter = 'hue-rotate(0deg)'; // Red
                    break;
                case 'fast':
                    ctx.filter = 'hue-rotate(120deg)'; // Green
                    break;
                case 'tank':
                    ctx.filter = 'hue-rotate(240deg)'; // Blue
                    break;
            }
            
            // Draw head
            const finalHeadOffsetY = y + offsets.headOffsetY;
            const headScale = currentMobType === 'tank' ? 1.2 : (currentMobType === 'fast' ? 0.9 : 1.0);
            
            if (offsets.headRotation !== 0) {
                ctx.save();
                const headX = x - width * 0.2 + offsets.headOffsetX;
                const headY = finalHeadOffsetY;
                const headW = width * 1.4 * headScale;
                const headH = height * 0.35 * headScale;
                ctx.translate(headX + headW/2, headY + headH/2);
                ctx.rotate(offsets.headRotation);
                ctx.drawImage(
                    mobAtlas,
                    headCoords.x, headCoords.y, headCoords.w, headCoords.h,
                    -headW/2, -headH/2, headW, headH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    headCoords.x, headCoords.y, headCoords.w, headCoords.h,
                    x - width * 0.2 + offsets.headOffsetX, finalHeadOffsetY,
                    width * 1.4 * headScale, height * 0.35 * headScale
                );
            }
            
            // Draw body
            const finalBodyOffsetY = y + offsets.bodyOffsetY + offsets.bodyBob;
            const bodyScale = currentMobType === 'tank' ? 1.3 : (currentMobType === 'fast' ? 0.8 : 1.0);
            
            if (offsets.bodyRotation !== 0) {
                ctx.save();
                const bodyX = x + width * 0.1 + offsets.bodyOffsetX;
                const bodyY = finalBodyOffsetY;
                const bodyW = width * 0.8 * bodyScale;
                const bodyH = height * 0.4 * bodyScale;
                ctx.translate(bodyX + bodyW/2, bodyY + bodyH/2);
                ctx.rotate(offsets.bodyRotation);
                ctx.drawImage(
                    mobAtlas,
                    bodyCoords.x, bodyCoords.y, bodyCoords.w, bodyCoords.h,
                    -bodyW/2, -bodyH/2, bodyW, bodyH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    bodyCoords.x, bodyCoords.y, bodyCoords.w, bodyCoords.h,
                    x + width * 0.1 + offsets.bodyOffsetX, finalBodyOffsetY,
                    width * 1.0 * bodyScale, height * 0.5 * bodyScale
                );
            }
            
            // Draw legs with full rotation support
            const legStartY = y + height * 0.25;
            const legWidth = width * 0.35;
            const legHeight = height * 0.8;
            const legScale = currentMobType === 'tank' ? 1.2 : (currentMobType === 'fast' ? 0.9 : 1.0);
            
            // LEFT THIGH with individual rotation
            if (offsets.leftThighRotation !== 0) {
                ctx.save();
                const thighX = x + width * 0.15 + offsets.leftLegX;
                const thighY = legStartY + offsets.leftThighBendY;
                const thighW = legWidth * legScale;
                const thighH = legHeight * 0.3 * legScale;
                ctx.translate(thighX + thighW / 2, thighY + thighH / 2);
                ctx.rotate(offsets.leftThighRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftThigh.x, legCoords.leftThigh.y, legCoords.leftThigh.w, legCoords.leftThigh.h,
                    -thighW / 2, -thighH / 2, thighW, thighH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftThigh.x, legCoords.leftThigh.y, legCoords.leftThigh.w, legCoords.leftThigh.h,
                    x + width * 0.15 + offsets.leftLegX, legStartY + offsets.leftThighBendY,
                    legWidth * legScale, legHeight * 0.3 * legScale
                );
            }
            
            // LEFT SHIN with individual rotation
            if (offsets.leftShinRotation !== 0) {
                ctx.save();
                const shinX = x + width * 0.15 + offsets.leftLegX + offsets.leftShinBendX;
                const shinY = legStartY + legHeight * 0.3 + offsets.leftShinBendY;
                const shinW = legWidth * legScale;
                const shinH = legHeight * 0.3 * legScale;
                ctx.translate(shinX + shinW / 2, shinY + shinH / 2);
                ctx.rotate(offsets.leftShinRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftShin.x, legCoords.leftShin.y, legCoords.leftShin.w, legCoords.leftShin.h,
                    -shinW / 2, -shinH / 2, shinW, shinH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftShin.x, legCoords.leftShin.y, legCoords.leftShin.w, legCoords.leftShin.h,
                    x + width * 0.15 + offsets.leftLegX + offsets.leftShinBendX, legStartY + legHeight * 0.3 + offsets.leftShinBendY,
                    legWidth * legScale, legHeight * 0.3 * legScale
                );
            }
            
            // LEFT SHOE with individual rotation
            if (offsets.leftShoeRotation !== 0) {
                ctx.save();
                const shoeX = x + width * 0.1 + offsets.leftLegX + offsets.leftShoeBendX;
                const shoeY = legStartY + legHeight * 0.5 + offsets.leftShoeBendY;
                ctx.translate(shoeX + legWidth * 0.6 * legScale, shoeY + legHeight * 0.1 * legScale);
                ctx.rotate(offsets.leftShoeRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftShoe.x, legCoords.leftShoe.y, legCoords.leftShoe.w, legCoords.leftShoe.h,
                    -legWidth * 0.6 * legScale, -legHeight * 0.1 * legScale,
                    legWidth * 1.2 * legScale, legHeight * 0.2 * legScale
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.leftShoe.x, legCoords.leftShoe.y, legCoords.leftShoe.w, legCoords.leftShoe.h,
                    x + width * 0.1 + offsets.leftLegX + offsets.leftShoeBendX, legStartY + legHeight * 0.5 + offsets.leftShoeBendY,
                    legWidth * 1.2 * legScale, legHeight * 0.2 * legScale
                );
            }
            
            // RIGHT THIGH with individual rotation
            if (offsets.rightThighRotation !== 0) {
                ctx.save();
                const thighX = x + width * 0.5 + offsets.rightLegX;
                const thighY = legStartY + offsets.rightThighBendY;
                const thighW = legWidth * legScale;
                const thighH = legHeight * 0.3 * legScale;
                ctx.translate(thighX + thighW / 2, thighY + thighH / 2);
                ctx.rotate(offsets.rightThighRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightThigh.x, legCoords.rightThigh.y, legCoords.rightThigh.w, legCoords.rightThigh.h,
                    -thighW / 2, -thighH / 2, thighW, thighH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightThigh.x, legCoords.rightThigh.y, legCoords.rightThigh.w, legCoords.rightThigh.h,
                    x + width * 0.5 + offsets.rightLegX, legStartY + offsets.rightThighBendY,
                    legWidth * legScale, legHeight * 0.3 * legScale
                );
            }
            
            // RIGHT SHIN with individual rotation
            if (offsets.rightShinRotation !== 0) {
                ctx.save();
                const shinX = x + width * 0.5 + offsets.rightLegX + offsets.rightShinBendX;
                const shinY = legStartY + legHeight * 0.3 + offsets.rightShinBendY;
                const shinW = legWidth * legScale;
                const shinH = legHeight * 0.3 * legScale;
                ctx.translate(shinX + shinW / 2, shinY + shinH / 2);
                ctx.rotate(offsets.rightShinRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightShin.x, legCoords.rightShin.y, legCoords.rightShin.w, legCoords.rightShin.h,
                    -shinW / 2, -shinH / 2, shinW, shinH
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightShin.x, legCoords.rightShin.y, legCoords.rightShin.w, legCoords.rightShin.h,
                    x + width * 0.5 + offsets.rightLegX + offsets.rightShinBendX, legStartY + legHeight * 0.3 + offsets.rightShinBendY,
                    legWidth * legScale, legHeight * 0.3 * legScale
                );
            }
            
            // RIGHT SHOE with individual rotation
            if (offsets.rightShoeRotation !== 0) {
                ctx.save();
                const shoeX = x + width * 0.45 + offsets.rightLegX + offsets.rightShoeBendX;
                const shoeY = legStartY + legHeight * 0.5 + offsets.rightShoeBendY;
                ctx.translate(shoeX + legWidth * 0.6 * legScale, shoeY + legHeight * 0.1 * legScale);
                ctx.rotate(offsets.rightShoeRotation);
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightShoe.x, legCoords.rightShoe.y, legCoords.rightShoe.w, legCoords.rightShoe.h,
                    -legWidth * 0.6 * legScale, -legHeight * 0.1 * legScale,
                    legWidth * 1.2 * legScale, legHeight * 0.2 * legScale
                );
                ctx.restore();
            } else {
                ctx.drawImage(
                    mobAtlas,
                    legCoords.rightShoe.x, legCoords.rightShoe.y, legCoords.rightShoe.w, legCoords.rightShoe.h,
                    x + width * 0.45 + offsets.rightLegX + offsets.rightShoeBendX, legStartY + legHeight * 0.5 + offsets.rightShoeBendY,
                    legWidth * 1.2 * legScale, legHeight * 0.2 * legScale
                );
            }
            
            // Reset filter
            ctx.filter = 'none';
        }
        
        function loadPreset(presetName) {
            document.getElementById('animationName').value = presetName;
            
            switch(presetName) {
                case 'patrol':
                    // Current patrol animation from your code
                    setSliderValue('headOffsetX', 15);
                    setSliderValue('headOffsetY', -36);
                    setSliderValue('headRotation', 0);
                    setSliderValue('bodyOffsetX', 1);
                    setSliderValue('bodyOffsetY', -5);
                    setSliderValue('bodyRotation', 0);
                    setSliderValue('leftLegX', 10);
                    setSliderValue('rightLegX', 3);
                    setSliderValue('bodyBob', 2);
                    // Reset all leg parameters to 0
                    resetLegParameters();
                    break;
                case 'chase':
                    setSliderValue('headOffsetX', -1);
                    setSliderValue('headOffsetY', -33);
                    setSliderValue('headRotation', -0.1);
                    setSliderValue('bodyOffsetX', 2);
                    setSliderValue('bodyOffsetY', -3);
                    setSliderValue('bodyRotation', -0.1);
                    setSliderValue('leftLegX', 5);
                    setSliderValue('rightLegX', -3);
                    setSliderValue('bodyBob', -1);
                    // Reset all leg parameters to 0
                    resetLegParameters();
                    break;
                case 'attack':
                    setSliderValue('headOffsetX', -3);
                    setSliderValue('headOffsetY', -33);
                    setSliderValue('headRotation', -0.2);
                    setSliderValue('bodyOffsetX', 2);
                    setSliderValue('bodyOffsetY', -3);
                    setSliderValue('bodyRotation', -0.1);
                    setSliderValue('leftLegX', 1);
                    setSliderValue('rightLegX', 2);
                    setSliderValue('bodyBob', 0);
                    // Reset all leg parameters to 0
                    resetLegParameters();
                    break;
            }
            updateAnimation();
        }
        
        function resetLegParameters() {
            // Reset all leg parameters to 0
            setSliderValue('leftThighBendY', 0);
            setSliderValue('leftThighRotation', 0);
            setSliderValue('leftShinBendY', 0);
            setSliderValue('leftShinBendX', 0);
            setSliderValue('leftShinRotation', 0);
            setSliderValue('leftShoeBendY', 0);
            setSliderValue('leftShoeBendX', 0);
            setSliderValue('leftShoeRotation', 0);
            setSliderValue('rightThighBendY', 0);
            setSliderValue('rightThighRotation', 0);
            setSliderValue('rightShinBendY', 0);
            setSliderValue('rightShinBendX', 0);
            setSliderValue('rightShinRotation', 0);
            setSliderValue('rightShoeBendY', 0);
            setSliderValue('rightShoeBendX', 0);
            setSliderValue('rightShoeRotation', 0);
        }
        
        function resetAll() {
            setSliderValue('headOffsetX', 0);
            setSliderValue('headOffsetY', -35);
            setSliderValue('headRotation', 0);
            setSliderValue('bodyOffsetX', 0);
            setSliderValue('bodyOffsetY', -5);
            setSliderValue('bodyRotation', 0);
            setSliderValue('leftLegX', 0);
            setSliderValue('rightLegX', 0);
            setSliderValue('bodyBob', 0);
            // Reset all leg parameters
            resetLegParameters();
            updateAnimation();
        }
        
        function setSliderValue(id, value) {
            const slider = document.getElementById(id);
            if (slider) {
                slider.value = value;
                const valueDisplay = document.getElementById(id + '-value');
                if (valueDisplay) {
                    valueDisplay.textContent = value;
                }
            }
        }
        
        function exportAnimation() {
            const animName = document.getElementById('animationName').value || 'custom';
            const headOffsetX = document.getElementById('headOffsetX').value;
            const headOffsetY = document.getElementById('headOffsetY').value;
            const headRotation = document.getElementById('headRotation').value;
            const bodyOffsetX = document.getElementById('bodyOffsetX').value;
            const bodyOffsetY = document.getElementById('bodyOffsetY').value;
            const bodyRotation = document.getElementById('bodyRotation').value;
            const leftLegX = document.getElementById('leftLegX').value;
            const rightLegX = document.getElementById('rightLegX').value;
            const bodyBob = document.getElementById('bodyBob').value;
            
            // Get all leg parameters
            const leftThighBendY = document.getElementById('leftThighBendY').value;
            const leftThighRotation = document.getElementById('leftThighRotation').value;
            const leftShinBendY = document.getElementById('leftShinBendY').value;
            const leftShinBendX = document.getElementById('leftShinBendX').value;
            const leftShinRotation = document.getElementById('leftShinRotation').value;
            const leftShoeBendY = document.getElementById('leftShoeBendY').value;
            const leftShoeBendX = document.getElementById('leftShoeBendX').value;
            const leftShoeRotation = document.getElementById('leftShoeRotation').value;
            
            const rightThighBendY = document.getElementById('rightThighBendY').value;
            const rightThighRotation = document.getElementById('rightThighRotation').value;
            const rightShinBendY = document.getElementById('rightShinBendY').value;
            const rightShinBendX = document.getElementById('rightShinBendX').value;
            const rightShinRotation = document.getElementById('rightShinRotation').value;
            const rightShoeBendY = document.getElementById('rightShoeBendY').value;
            const rightShoeBendX = document.getElementById('rightShoeBendX').value;
            const rightShoeRotation = document.getElementById('rightShoeRotation').value;
            
            const code = `// ${animName} animation - custom animation from mob tester
headOffsetX = ${headOffsetX};
headOffsetY = ${headOffsetY};
headRotation = ${headRotation};
bodyOffsetX = ${bodyOffsetX};
bodyOffsetY = ${bodyOffsetY};
bodyRotation = ${bodyRotation};
leftLegX = ${leftLegX};
rightLegX = ${rightLegX};
bodyBob = ${bodyBob};
// Leg positions
leftThighBendY = ${leftThighBendY};
leftThighRotation = ${leftThighRotation};
leftShinBendY = ${leftShinBendY};
leftShinBendX = ${leftShinBendX};
leftShinRotation = ${leftShinRotation};
leftShoeBendY = ${leftShoeBendY};
leftShoeBendX = ${leftShoeBendX};
leftShoeRotation = ${leftShoeRotation};
rightThighBendY = ${rightThighBendY};
rightThighRotation = ${rightThighRotation};
rightShinBendY = ${rightShinBendY};
rightShinBendX = ${rightShinBendX};
rightShinRotation = ${rightShinRotation};
rightShoeBendY = ${rightShoeBendY};
rightShoeBendX = ${rightShoeBendX};
rightShoeRotation = ${rightShoeRotation};`;
            
            const output = document.getElementById('codeOutput');
            output.textContent = code;
            output.style.display = 'block';
            
            // Copy to clipboard
            navigator.clipboard.writeText(code).then(() => {
                console.log('Animation code copied to clipboard!');
            });
        }
    </script>
</body>
</html>